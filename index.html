 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/index.html b/index.html
index 8433596b511f28116c42b2aa9392489a96d45c2f..0c622af2ce39a9107a97acc95a6fdd236b3be136 100644
--- a/index.html
+++ b/index.html
@@ -58,188 +58,228 @@
         </div>
       </div>
 
       <div class="row">
         <div>
           <label>Total Pages</label>
           <input id="pages" type="number" value="120" min="20" step="2"/>
         </div>
         <div>
           <label>Trim</label>
           <select id="trim">
             <option value="letter">8.5 × 11 in (Letter)</option>
           </select>
         </div>
       </div>
 
       <label>Title</label>
       <input id="title" placeholder="e.g., The Giant Puzzle Book"/>
 
       <label>Subtitle</label>
       <input id="subtitle" placeholder="Optional subtitle"/>
 
       <label>Author / Imprint</label>
       <input id="author" value="Puzzle & Prose Co"/>
 
+      <label>OpenAI API Key <span class="muted" style="font-weight:400">(optional)</span></label>
+      <input id="apiKey" type="password" placeholder="sk-..."/>
+
+      <div class="row">
+        <div>
+          <label style="font-size:12px">Project ID</label>
+          <input id="projectId" placeholder="proj_..."/>
+        </div>
+        <div>
+          <label style="font-size:12px">Org ID</label>
+          <input id="orgId" placeholder="org_..."/>
+        </div>
+      </div>
+
       <hr style="border:none;border-top:1px solid var(--border);margin:12px 0"/>
 
       <div class="row" style="margin-top:8px">
         <button id="btnSuggest" class="secondary">Get GPT Suggestions</button>
         <button id="btnExpand" class="secondary">Expand Wordlists to 60</button>
       </div>
 
       <label>Themes (one per line)</label>
       <textarea id="themes" placeholder="BIRDS&#10;OCEAN&#10;GARDEN"></textarea>
 
       <label>Word Lists (CSV — THEME, WORD1, WORD2, ...)</label>
       <textarea id="wordlists" placeholder="BIRDS, ROBIN, SWALLOW, EAGLE, FALCON, PARROT, ..."></textarea>
 
       <div class="row" style="margin-top:10px">
         <button id="btnPlan">Prepare Puzzles</button>
         <button id="btnInterior">Build Interior PDF</button>
       </div>
       <div class="row" style="margin-top:10px">
         <button id="btnCover">Build Cover PDF</button>
         <button id="btnCancel" class="secondary" disabled>Cancel Build</button>
       </div>
     </div>
 
     <div class="card">
       <div class="row">
         <button id="btnClearLog" class="secondary">Clear Log</button>
         <a id="dlLast" class="secondary" style="text-align:center;display:block;padding:10px;text-decoration:none;border-radius:8px;border:1px solid var(--border);color:#dbe4f3" href="#" download>Download last PDF</a>
       </div>
+      <div class="row" style="margin-top:10px">
+        <button id="btnExportPlan" class="secondary">Export Plan JSON</button>
+        <button id="btnImportPlan" class="secondary">Import Plan JSON</button>
+      </div>
+      <input type="file" id="planFile" accept=".json" style="display:none"/>
       <label>Log</label>
       <div id="log"></div>
     </div>
   </aside>
 
   <section>
     <div class="card">
       <label>Preview</label>
       <canvas id="preview"></canvas>
       <div class="muted" style="margin-top:6px">Preview shows the first puzzle; export uses the cached plan.</div>
     </div>
   </section>
 </main>
 
 <script>
 /* =======================
    Config (optional GPT)
    Leave empty to run fully offline.
 ======================= */
-const FORCE_API_KEY    = "";     // "sk-..." or "sk-proj-..."
-const FORCE_PROJECT_ID = "";     // "proj_..." (required for sk-proj-)
-const FORCE_ORG_ID     = "";     // optional
+let FORCE_API_KEY    = "";     // "sk-..." or "sk-proj-..."
+let FORCE_PROJECT_ID = "";     // "proj_..." (required for sk-proj-)
+let FORCE_ORG_ID     = "";     // optional
+
+const getAPIKey    = ()=> ($("apiKey")?.value || FORCE_API_KEY).trim();
+const getProjectId = ()=> ($("projectId")?.value || FORCE_PROJECT_ID).trim();
+const getOrgId     = ()=> ($("orgId")?.value || FORCE_ORG_ID).trim();
 
 /* =======================
    Utilities & State
 ======================= */
 const $ = id => document.getElementById(id);
 const Log = { write(...a){ const el=$("log"); el.textContent += a.join(" ") + "\n"; el.scrollTop = el.scrollHeight; } };
 window.addEventListener('error', e=> Log.write('JS Error:', e.message));
 
 let RNG = Math.random;
 function randi(n){ return Math.floor(RNG()*n); }
 function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=randi(i+1); [a[i],a[j]]=[a[j],a[i]]; } return a; }
 
 const STATE = { plan: { sudoku:[], wordsearch:[], crossword:[] }, worker:null, cancel:false };
 
 function parseThemes(){ const t=$("themes").value.trim(); return t? t.split(/\n+/).map(s=>s.trim()).filter(Boolean):[]; }
 function parseWordlists(){
   const txt = $("wordlists").value.trim(); if(!txt) return [];
   const lines = txt.split(/\n+/).map(s=>s.trim()).filter(Boolean); const out=[];
   for(const line of lines){
     const parts=line.split(/\s*,\s*/).map(x=>x.trim()).filter(Boolean);
     if(!parts.length) continue;
     const theme=(parts[0]||'MISC').toUpperCase().replace(/[^A-Z0-9 ]/g,'');
     const words=parts.slice(1).map(w=>w.toUpperCase().replace(/[^A-Z]/g,'')).filter(Boolean);
     out.push({ theme, words });
   }
   return out;
 }
-const hasAPI = ()=> !!(FORCE_API_KEY && FORCE_API_KEY.trim());
+const hasAPI = ()=> !!getAPIKey();
 
 /* =======================
    OpenAI (optional)
 ======================= */
 async function openaiJSON(prompt){
-  const key  = (FORCE_API_KEY||"").trim();
-  if(!key) throw new Error("No API key configured — set FORCE_API_KEY at the top.");
-  const proj = (FORCE_PROJECT_ID||"").trim();
-  const org  = (FORCE_ORG_ID||"").trim();
+  const key  = getAPIKey();
+  if(!key) throw new Error("No API key configured — paste it in the OpenAI API Key field.");
+  const proj = getProjectId();
+  const org  = getOrgId();
 
   const headers = { "Content-Type":"application/json", "Authorization":`Bearer ${key}` };
   if(key.startsWith("sk-proj-") && proj) headers["OpenAI-Project"] = proj;
   if(org) headers["OpenAI-Organization"] = org;
 
   const body = { model:"gpt-4o-mini", temperature:0.2, response_format:{type:"json_object"}, messages:[{role:"user", content: prompt}] };
 
   const res = await fetch("https://api.openai.com/v1/chat/completions", { method:"POST", headers, body: JSON.stringify(body) });
   const text = await res.text();
   if(!res.ok){ throw new Error(text); }
 
   let content;
   try{ const j=JSON.parse(text); content=(j?.choices?.[0]?.message?.content||"").trim(); }catch{ throw new Error("Unexpected API response"); }
   if(/^```/.test(content)) content = content.replace(/^```[a-zA-Z]*\n?|```$/g,"");
   try{ return JSON.parse(content); }catch{ const m=content.match(/\{[\s\S]*\}/); if(!m) throw new Error("No JSON found"); return JSON.parse(m[0]); }
 }
 
 /* =======================
    Sudoku
 ======================= */
 const Sudoku = (function(){
+  function can(g,r,c,v){
+    for(let i=0;i<9;i++) if(g[r][i]===v||g[i][c]===v) return false;
+    const br=Math.floor(r/3)*3, bc=Math.floor(c/3)*3;
+    for(let rr=br;rr<br+3;rr++) for(let cc=bc;cc<bc+3;cc++) if(g[rr][cc]===v) return false;
+    return true;
+  }
   function solved(){
     const g=Array.from({length:9},()=>Array(9).fill(0));
     const nums=[1,2,3,4,5,6,7,8,9];
-    function can(r,c,v){
-      for(let i=0;i<9;i++) if(g[r][i]===v||g[i][c]===v) return false;
-      const br=Math.floor(r/3)*3, bc=Math.floor(c/3)*3;
-      for(let rr=br;rr<br+3;rr++) for(let cc=bc;cc<bc+3;cc++) if(g[rr][cc]===v) return false;
-      return true;
-    }
     function solve(k=0){
       if(k===81) return true;
       const r=Math.floor(k/9), c=k%9;
       const order=shuffle(nums.slice());
-      for(const v of order){ if(can(r,c,v)){ g[r][c]=v; if(solve(k+1)) return true; g[r][c]=0; } }
+      for(const v of order){ if(can(g,r,c,v)){ g[r][c]=v; if(solve(k+1)) return true; g[r][c]=0; } }
       return false;
     }
     solve(0); return g;
   }
+  function hasUniqueSolution(p){
+    const g=p.map(r=>r.slice());
+    let count=0;
+    function search(){
+      let r=-1,c=-1;
+      for(let i=0;i<81;i++){ const rr=Math.floor(i/9), cc=i%9; if(g[rr][cc]===0){ r=rr; c=cc; break; } }
+      if(r===-1){ count++; return; }
+      for(let v=1; v<=9 && count<2; v++){
+        if(can(g,r,c,v)){ g[r][c]=v; search(); g[r][c]=0; }
+      }
+    }
+    search(); return count===1;
+  }
   function mask(sol,diff){
     const clues = { easy:40, medium:32, hard:26 }[diff] || 32;
-    const g = sol.map(r=>r.slice()); let rem=81-clues;
-    while(rem>0){
-      const r=randi(9), c=randi(9);
-      if(g[r][c]!==0){
-        const r2=8-r, c2=8-c;
-        g[r][c]=0; rem--;
-        if(rem>0 && g[r2][c2]!==0){ g[r2][c2]=0; rem--; }
+    for(let attempt=0; attempt<100; attempt++){
+      const g = sol.map(r=>r.slice());
+      let filled=81;
+      while(filled>clues){
+        const r=randi(9), c=randi(9);
+        if(g[r][c]!==0){
+          const r2=8-r, c2=8-c;
+          g[r][c]=0; filled--;
+          if((r2!==r||c2!==c) && filled>clues && g[r2][c2]!==0){ g[r2][c2]=0; filled--; }
+        }
       }
+      if(hasUniqueSolution(g)) return g;
     }
-    return g;
+    return sol.map(r=>r.slice());
   }
   function draw(ctx, grid, title, withNote=false){
     const W=800,H=1000; ctx.canvas.width=W; ctx.canvas.height=H;
     ctx.fillStyle="#fff"; ctx.fillRect(0,0,W,H);
     ctx.fillStyle="#000"; ctx.font="bold 22px Arial"; ctx.fillText(title, 40, 40);
     if(withNote){ ctx.font="12px Arial"; ctx.fillText("Fill digits 1–9. No repeats in rows, columns, or 3×3 boxes.", 40, 62); }
     const size=Math.min(W-80,H-140), cell=size/9, x0=40, y0=90; ctx.strokeStyle="#000"; ctx.lineWidth=1;
     for(let r=0;r<9;r++) for(let c=0;c<9;c++){
       const x=x0+c*cell, y=y0+r*cell; ctx.strokeRect(x,y,cell,cell);
       const v=grid[r][c];
       if(v){ ctx.font=`${Math.floor(cell*0.6)}px Arial`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(String(v), x+cell/2, y+cell/2); }
     }
     ctx.lineWidth=3; for(let i=0;i<=9;i+=3){
       ctx.beginPath(); ctx.moveTo(x0, y0+i*cell); ctx.lineTo(x0+9*cell, y0+i*cell); ctx.stroke();
       ctx.beginPath(); ctx.moveTo(x0+i*cell, y0); ctx.lineTo(x0+i*cell, y0+9*cell); ctx.stroke();
     }
   }
   return { solved, mask, draw };
 })();
 
 /* =======================
    Word Search
 ======================= */
 const WordSearch = (function(){
   function cleanWords(words){
diff --git a/index.html b/index.html
index 8433596b511f28116c42b2aa9392489a96d45c2f..0c622af2ce39a9107a97acc95a6fdd236b3be136 100644
--- a/index.html
+++ b/index.html
@@ -731,33 +771,60 @@ $("btnCover").onclick = ()=>{
     const author=$("author").value||'Puzzle & Prose Co';
 
     doc.setFont('times','bold'); doc.setFontSize(22);
     doc.text(title, frontX + (trimW*DPI)/2, (coverHIn*DPI)/2 - 10, {align:'center'});
     doc.setFont('times','normal'); doc.setFontSize(12);
     doc.text(author, frontX + (trimW*DPI)/2, (coverHIn*DPI)/2 + 14, {align:'center'});
 
     doc.setFont('times','bold'); doc.setFontSize(12);
     const spineX = backW + spineW/2;
     doc.text(title, spineX, (coverHIn*DPI)/2, {angle:90, align:'center'});
 
     doc.setFont('times','italic'); doc.setFontSize(12);
     doc.text('Puzzle & Prose Co', (trimW*DPI)/2, (coverHIn*DPI)/2, {align:'center'});
 
     const blob = doc.output('blob'); const url = URL.createObjectURL(blob);
     const a=document.createElement('a'); a.href=url; a.download='cover-wrap.pdf'; a.click();
     $("dlLast").href = url; $("dlLast").download='cover-wrap.pdf';
     Log.write('✓ cover-wrap.pdf generated. Spine ~ ' + spineIn.toFixed(3) + ' in');
   }catch(e){ Log.write('Cover error:', e.message); }
 };
 
 /* =======================
    Boot
 ======================= */
 (function boot(){
+  [
+    ["apiKey",     FORCE_API_KEY],
+    ["projectId",  FORCE_PROJECT_ID],
+    ["orgId",      FORCE_ORG_ID]
+  ].forEach(([id,val])=>{ if(val) $(id).value = val; });
+
   const canvas=$("preview"); const ctx=canvas.getContext('2d');
   ctx.fillStyle="#101317"; ctx.fillRect(0,0,canvas.width=800,canvas.height=980);
   ctx.fillStyle="#9aa4b2"; ctx.font="14px Arial"; ctx.fillText("No plan yet. Click Prepare Puzzles.",24,30);
   $("btnClearLog").onclick = ()=>{ $("log").textContent=''; };
+  $("btnExportPlan").onclick = ()=>{
+    const data=JSON.stringify(STATE.plan,null,2);
+    const blob=new Blob([data],{type:'application/json'});
+    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='plan.json'; a.click();
+    Log.write('✓ Plan exported.');
+  };
+  $("btnImportPlan").onclick = ()=> $("planFile").click();
+  $("planFile").addEventListener('change', e=>{
+    const file=e.target.files[0]; if(!file) return;
+    const reader=new FileReader();
+    reader.onload=evt=>{
+      try{
+        const plan=JSON.parse(evt.target.result);
+        STATE.plan={ sudoku:plan.sudoku||[], wordsearch:plan.wordsearch||[], crossword:plan.crossword||[] };
+        renderPreview();
+        Log.write('✓ Plan imported.');
+      }catch(err){ Log.write('Import error:', err.message); }
+    };
+    reader.readAsText(file);
+    e.target.value='';
+  });
 })();
 </script>
 </body>
 </html>
